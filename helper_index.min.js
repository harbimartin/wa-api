var url_string = window.location.href;
var url = new URL(url_string);
var c = url.searchParams.get("msg");
let message = "";
let log = "";
const host = 'http://192.168.0.23/api/v1/checkWhatsapp';
//const host = 'http://' + location.hostname + '/api/v1/checkWhatsapp';
document.getElementById("send").addEventListener("click", () => {
    const data = {
        pnumber: document.getElementById('pnumber').value
    };
    fetch(host, {
        method: 'POST', // *GET, POST, PUT, DELETE, etc.
        mode: 'cors', // no-cors, *cors, same-origin
        cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
        credentials: 'same-origin', // include, *same-origin, omit
        headers: {
            'Content-Type': 'application/json'
            // 'Content-Type': 'application/x-www-form-urlencoded',
        },
        redirect: 'follow', // manual, *follow, error
        referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
        body: JSON.stringify(data) // body data type must match "Content-Type" header
    })
        .then(response => response.text())
        .then(data => {
            log += data;
            document.getElementById('pnumber').value = '';
            document.getElementById('log').innerHTML = log;
        });
});
document.getElementById("logout").addEventListener("click", () => {
    fetch(window.location.origin + '/logout', {
        method: 'POST', // *GET, POST, PUT, DELETE, etc.
        mode: 'cors', // no-cors, *cors, same-origin
        cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
        credentials: 'same-origin', // include, *same-origin, omit
        headers: {
            'Content-Type': 'application/json'
            // 'Content-Type': 'application/x-www-form-urlencoded',
        },
        redirect: 'follow', // manual, *follow, error
        referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
        body: null // body data type must match "Content-Type" header
    })
        .then(response => {
            if (response.status == 200) {
                setTimeout(() => {
                    window.location.href = window.location.origin;
                })
            }
            return response.text();
        })
        .then(data => {
            log += data;
            document.getElementById('pnumber').value = '';
            document.getElementById('log').innerHTML = log;
        });
});
fetch(window.location.origin + '/getMe')
    .then(response => response.json())
    .then(data => {
        log = `<div class="bg-yellow-100 p-2"><span class="text-yellow-800">Logged as <img class="inline rounded-full mb-1 mr-1 shadow" src="${data.pict}" width="24" height"24"/></span>${data.info.pushname} (+${data.info.me.user})</div>`;
        document.getElementById('message').value = '';
        document.getElementById('log').innerHTML = log;
    });